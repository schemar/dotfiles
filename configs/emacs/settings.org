#+title: Emacs settings file

* Basics and Package Management
  Create another auto-generated init file so that the handcrafted one won't be overwritten by Emacs.
  #+BEGIN_SRC emacs-lisp
    (setq custom-file (expand-file-name "auto-generated.el" user-emacs-directory))
    (when (file-exists-p custom-file)
      (load custom-file))
  #+END_SRC

** Package Management
   Use straight for package management (instead of the built-in package).
   *Make sure to not use ~:ensure~ in any ~use-package~ blocks.*
   #+BEGIN_SRC emacs-lisp
   #+END_SRC

* Org, Org-Roam, and productivity
** Org
   The built-in version of Org is outdated and not sufficient for Org-Roam.
   Thanks to the straight package manager, we can use a simple ~use-package~ and straight will replace the built-in version with the latest version from ELPA.
   However, we must load org already in ~init.el~ in order to load the package before it is used to load this file.

   For org, use ~indented~ to show sub-items indented instead of all the leading asterisks.
   Hide emphasis markers and only use font face change as indication.

   Org-super-agenda and org-ql do not support tag groups. So it doesn't make sense to set them up.
   #+BEGIN_SRC emacs-lisp
       (setq org-startup-indented t
             org-pretty-entities t
             org-hide-emphasis-markers t
             org-startup-with-inline-images t
             org-image-acual-width '(300))
       (setq org-todo-keywords '((type "TODO(t)" "WAITING(w)" "FOLLOWUP(f)" "|" "DONE(d)" "DELEGATED(l)" "ABANDONED(a)")))
       (setq org-agenda-files (directory-files-recursively "~/Documents/org/" "\\.org$"))
       (define-prefix-command 'org-user-map)
       (global-set-key (kbd "C-c o") 'org-user-map)
   #+END_SRC

   Use org-appear to show emphasis-markers, which are hidden otherwise, when the cursor is on them.
   #+BEGIN_SRC emacs-lisp
       (use-package org-appear
         :hook (org-mode . org-appear-mode))
   #+END_SRC

   Use org-superstar to make the bullets look nicer.
   #+BEGIN_SRC emacs-lisp
     (use-package org-superstar
       :config
       (add-hook 'org-mode-hook (lambda () (org-superstar-mode 1))))
   #+END_SRC
    
** Org-QL
   Org query language to build agenda-like views based on an input query.
   #+BEGIN_SRC emacs-lisp
     (use-package org-ql)
   #+END_SRC

** Org-Super-Agenda
Org super agenda groups agendas into groups based on its configuration.
All groups must be configured here using the project's syntax.
Super agenda does not support tag groups, that's why we have to list *all* relevant tags.
   #+BEGIN_SRC emacs-lisp
     (use-package org-super-agenda
       :config
       (setq org-super-agenda-groups '(
                                       (:name "Today"
                                        :scheduled today
                                        :scheduled past
                                        :deadline today
                                        :deadline past)
                                       (:name "Futurice"
                                        :and (:tag "futurice"
                                        :not (:todo ("WAITING" "FOLLOWUP"))))
                                       (:name "Private"
                                        :and (:tag "private"
                                        :not (:todo ("WAITING" "FOLLOWUP"))))
                                       (:name "Follow-up"
                                        :todo "FOLLOWUP")
                                       (:name "Waiting"
                                        :todo "WAITING"))))
     (org-super-agenda-mode)
   #+End_SRC

** Org-Roam
   #+BEGIN_SRC emacs-lisp
      (use-package org-roam
        :config
        (setq org-roam-directory (file-truename "~/Documents/org")
      	org-roam-dailies-directory "daily/"
      	org-roam-dailies-capture-templates
      	'(("d" "default" entry
      	   "* %?"
      	   :target (file+head "%<%Y-%m-%d>.org"
      			      "#+title: %<%Y-%m-%d>\n"))))
        (org-roam-db-autosync-mode)
        (add-to-list 'display-buffer-alist
      	     '("\\*org-roam\\*"
      	       (display-buffer-in-direction)
      	       (direction . right)
      	       (window-width . 0.33)
      	       (window-height . fit-window-to-buffer)))
        :bind
        ("C-c o i" . org-roam-node-insert)
        ("C-c o f" . org-roam-node-find)
        ("C-c o c" . org-roam-capture)
        ("C-c o b" . org-roam-buffer-toggle)
        ("C-c o a" . org-roam-alias-add)
        ("C-c o r" . org-roam-ref-add)
        ("C-c o t" . org-roam-dailies-goto-today))
   #+END_SRC

** Deft
   Show and filter org-roam notes by contained text.
   #+BEGIN_SRC emacs-lisp
     (use-package deft
       :after org
       :bind
       ("C-c o d" . deft)
       :custom
       (deft-recursive t)
       (deft-use-filter-string-for-filename t)
       (deft-default-extension "org")
       (deft-directory org-roam-directory))
   #+END_SRC

** Winner Mode
   Winner mode to go back/forward when interacting with org-roam using ~M-left/M-right~.
   #+BEGIN_SRC emacs-lisp
     (winner-mode +1)
     (define-key winner-mode-map (kbd "<M-left>") #'winner-undo)
     (define-key winner-mode-map (kbd "<M-right>") #'winner-redo)
  #+END_SRC

* EViL Mode
** EViL mode itself
#+BEGIN_SRC emacs-lisp
  (use-package evil
    :init
    (setq evil-want-keybinding nil)
    :config
    (evil-mode 1))
#+END_SRC
** Use evil-collection to have evil-bindings in other packages like magit.
#+BEGIN_SRC emacs-lisp
  (use-package evil-collection
    :after evil
    :config
    (evil-collection-init))
#+END_SRC
** Use evil-org to have evil-bindings in org-mode.
#+BEGIN_SRC emacs-lisp
  (use-package evil-org
    :after org
    :hook (org-mode . (lambda () evil-org-mode))
    :config
    (require 'evil-org-agenda)
    (evil-org-agenda-set-keys))
#+END_SRC

* Help
  Show all available key-bindings in the mini buffer.
  #+BEGIN_SRC emacs-lisp
    (use-package which-key
      :config
      (which-key-mode))
  #+END_SRC

  Company for auto-completion.
  #+BEGIN_SRC emacs-lisp
    (use-package company
      :config
      (setq company-idle-delay 0
	    company-minimum-prefix-length 4
	    company-selection-wrap-around t))
    (add-hook 'after-init-hook 'global-company-mode)
  #+END_SRC

* Visuals
** Window
  Remove startup message, tool bar, menu bar, and scroll bar.
  #+BEGIN_SRC emacs-lisp
    (setq inhibit-startup-message t)
    (tool-bar-mode -1)
    (menu-bar-mode -1)
    (scroll-bar-mode -1)
  #+END_SRC

** Fonts
   Set a default font for all windows.
   #+BEGIN_SRC emacs-lisp
     (set-frame-font "DejaVuSansMono Nerd Font Mono 11" nil t)
   #+END_SRC

*** TODO Use a variable pitch (non-monospaced) font for org-mode, but not for code blocks inside org.

** Theme
   #+BEGIN_SRC emacs-lisp
     (use-package nord-theme
       :config
       (load-theme 'nord t))
   #+END_SRC

** Mode Line
  Modeline that looks like power line.
  #+BEGIN_SRC emacs-lisp
    (use-package powerline
      :config
      (powerline-default-theme))
    (setq column-number-mode t)
  #+END_SRC

* IDE Features
  Counsel, Ivy, and Swipe for more complete completion and filtering.
  #+BEGIN_SRC emacs-lisp
    (use-package counsel
      :config
      (ivy-mode 1)
      (counsel-mode 1)
      (setq ivy-use-virtual-buffers t
	    ivy-count-format "(%d/%d) "
	    ivy-re-builders-alist
	  '((t . ivy--regex-ignore-order)))
      (define-prefix-command 'emacs-counsel-map)
      (global-set-key (kbd "C-c e") 'emacs-counsel-map)
      (global-set-key (kbd "C-s") 'swiper-isearch)
      (global-set-key (kbd "M-x") 'counsel-M-x)
      (global-set-key (kbd "C-x C-f") 'counsel-find-file)
      (global-set-key (kbd "M-y") 'counsel-yank-pop)
      (global-set-key (kbd "C-c e f") 'counsel-describe-function)
      (global-set-key (kbd "C-c e v") 'counsel-describe-variable)
      (global-set-key (kbd "C-c e l") 'counsel-find-library)
      (global-set-key (kbd "C-c e i") 'counsel-info-lookup-symbol)
      (global-set-key (kbd "C-c e u") 'counsel-unicode-char)
      (global-set-key (kbd "C-c e j") 'counsel-set-variable)
      (global-set-key (kbd "C-x b") 'ivy-switch-buffer)
      (global-set-key (kbd "C-c v") 'ivy-push-view)
      (global-set-key (kbd "C-c V") 'ivy-pop-view)
      (global-set-key (kbd "C-c k") 'counsel-rg)
      (global-set-key (kbd "C-c m") 'counsel-linux-app)
      (global-set-key (kbd "C-c n") 'counsel-fzf)
      (global-set-key (kbd "C-x l") 'counsel-locate)
      (global-set-key (kbd "C-c J") 'counsel-file-jump)
      (global-set-key (kbd "C-c C-r") 'ivy-resume)
      (global-set-key (kbd "C-c b") 'counsel-bookmark)
      (global-set-key (kbd "C-c l") 'counsel-outline)
      (global-set-key (kbd "C-c F") 'counsel-org-file))
  #+END_SRC

  Projectile for project navigation.
  #+BEGIN_SRC emacs-lisp
    (use-package projectile
      :config
      (projectile-mode +1)
      (define-key projectile-mode-map (kbd "C-c p") 'projectile-command-map))

    (use-package counsel-projectile
      :config
      (counsel-projectile-mode 1))
  #+END_SRC

  Magit for git integration.
  #+BEGIN_SRC emacs-lisp
    (use-package magit)
  #+END_SRC

* Programming
  #+BEGIN_SRC emacs-lisp
    ;; Add line numbers in all programming modes.
    (add-hook 'prog-mode-hook 'display-line-numbers-mode)

    ;; Highlight numerals
    (use-package highlight-numbers
      :config
      (add-hook 'prog-mode-hook 'highlight-numbers-mode))

    ;; flycheck for all languages to do diagnostics in-line.
    (use-package flycheck
      :init (global-flycheck-mode))

    ;; YAML
    (use-package yaml-mode)

    ;; Web Mode for all things web.
    (use-package web-mode)

    ;; TypeScript
    (use-package tide
      :after (typescript-mode company flycheck)
      :hook ((typescript-mode . tide-setup)
	     (typescript-mode . tide-hl-identifier-mode)
	     (before-save . tide-format-before-save)))
    ;; TSX
    (require 'web-mode)
    (add-to-list 'auto-mode-alist '("\\.tsx\\'" . web-mode))
    (add-hook 'web-mode-hook
	      (lambda ()
		(when (string-equal "tsx" (file-name-extension buffer-file-name))
		  (setup-tide-mode))))
    ;; enable typescript-tslint checker
    (flycheck-add-mode 'typescript-tslint 'web-mode)
  #+END_SRC
  
